<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
  --bg:#0f0f0f;
  --card:#1c1c1c;
  --text:#fff;
  --muted:#aaa;
  --accent:#ff0000;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  overflow:hidden;
}

/* HEADER */
header{
  background:#000;
  padding:10px;
}
.search{
  width:100%;
  padding:10px;
  border-radius:6px;
  border:none;
  font-size:16px;
}

/* CATEGORIES */
.categories{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding:10px;
}
.categories button{
  background:#222;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
}
.categories button.active{background:var(--accent)}

/* PLAYER */
.player-wrapper{
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  position:relative;
  overflow:hidden;
}

/* inactive */
.player-wrapper.inactive video{
  display:none;
}
.player-wrapper.inactive::after{
  content:"Select a channel to start watching";
  color:#777;
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
}

/* VIDEO */
video{
  width:100%;
  height:100%;
  background:#000;
}

/* FULLSCREEN BUTTON */
.fullscreen-btn{
  position:absolute;
  bottom:10px;
  right:10px;
  z-index:5;
  background:rgba(0,0,0,.75);
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}

/* LOADER */
.loader{
  position:absolute;
  inset:0;
  background:linear-gradient(
    90deg,
    #111 25%,
    #222 37%,
    #111 63%
  );
  background-size:400% 100%;
  animation:shimmer 1.2s infinite;
}
@keyframes shimmer{
  0%{background-position:100% 0}
  100%{background-position:0 0}
}
.hidden{display:none}

/* LIST */
.list-container{
  height:calc(100vh - 56px - 56px - 28vw);
  overflow-y:auto;
}

/* GRID (START) */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:10px;
  padding:10px;
}

/* LIST (AFTER PLAY) */
.list{
  padding:10px;
}

/* CHANNEL */
.channel{
  background:var(--card);
  border-radius:8px;
  padding:10px;
  cursor:pointer;
  display:flex;
  gap:10px;
}
.grid .channel{
  flex-direction:column;
  align-items:center;
  text-align:center;
}
.channel img{
  width:80px;
  height:80px;
  object-fit:contain;
  background:#000;
  border-radius:6px;
}
.channel h4{
  margin:6px 0 0;
  font-size:14px;
}
.channel span{
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>

<header>
  <input id="search" class="search" placeholder="Search channels...">
</header>

<div class="categories" id="categories"></div>

<div class="player-wrapper inactive" id="playerBox">
  <video id="video" controls playsinline webkit-playsinline></video>
  <button class="fullscreen-btn" id="fsBtn">⛶</button>
  <div class="loader hidden" id="loader"></div>
</div>

<div class="list-container">
  <div id="channelList" class="grid"></div>
</div>

<script>
const M3U_URL="https://iptv-org.github.io/iptv/index.m3u";

const video=document.getElementById("video");
const loader=document.getElementById("loader");
const playerBox=document.getElementById("playerBox");
const list=document.getElementById("channelList");
const search=document.getElementById("search");
const categories=document.getElementById("categories");
const fsBtn=document.getElementById("fsBtn");

let channels=[],hls;
let currentCategory="All";
let hasPlayed=false;

/* LOAD */
fetch(M3U_URL).then(r=>r.text()).then(parseM3U);

function parseM3U(text){
  const lines=text.split("\n");
  let ch=null;
  lines.forEach(l=>{
    if(l.startsWith("#EXTINF")){
      ch={
        name:(l.match(/,(.*)/)||[])[1]||"",
        logo:(l.match(/tvg-logo="(.*?)"/)||[])[1]||"",
        group:(l.match(/group-title="(.*?)"/)||[])[1]||"Other"
      };
    }else if(l.startsWith("http")){
      ch.url=l.trim();
      channels.push(ch);
      ch=null;
    }
  });
  initCategories();
  render();
}

/* CATEGORIES */
function initCategories(){
  ["All",...new Set(channels.map(c=>c.group))].forEach(g=>{
    const b=document.createElement("button");
    b.textContent=g;
    if(g==="All") b.classList.add("active");
    b.onclick=()=>{
      currentCategory=g;
      [...categories.children].forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      render();
    };
    categories.appendChild(b);
  });
}

/* RENDER */
function render(){
  list.innerHTML="";
  const q=search.value.toLowerCase();
  list.className=hasPlayed?"list":"grid";

  channels.filter(c=>
    (currentCategory==="All"||c.group===currentCategory) &&
    c.name.toLowerCase().includes(q)
  ).slice(0,200).forEach(c=>{
    const d=document.createElement("div");
    d.className="channel";
    d.innerHTML=`
      <img src="${c.logo||''}" onerror="this.src='https://via.placeholder.com/80'">
      <h4>${c.name}</h4>
      <span>${c.group}</span>`;
    d.onclick=()=>play(c.url);
    list.appendChild(d);
  });
}

/* PLAY */
function play(url){
  hasPlayed=true;
  playerBox.classList.remove("inactive");
  loader.classList.remove("hidden");

  if(hls) hls.destroy();

  if(Hls.isSupported()){
    hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>{
      loader.classList.add("hidden");
      video.play();
    });
  }else{
    video.src=url;
    video.onloadeddata=()=>{
      loader.classList.add("hidden");
      video.play();
    };
  }
  render();
}

/* FULLSCREEN – WORKING ON ALL DEVICES */
fsBtn.onclick=()=>{
  if(video.requestFullscreen){
    video.requestFullscreen();
  }else if(video.webkitEnterFullscreen){
    video.webkitEnterFullscreen(); // iOS / some Android
  }else if(video.webkitRequestFullscreen){
    video.webkitRequestFullscreen();
  }else if(video.msRequestFullscreen){
    video.msRequestFullscreen();
  }
};

search.oninput=render;
</script>

</body>
</html>
